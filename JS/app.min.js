/******/ (() => { // webpackBootstrap
/******/ 	"use strict";
/******/ 	var __webpack_modules__ = ({

/***/ 818:
/***/ ((module, __webpack_exports__, __webpack_require__) => {

/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "Z": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _node_modules_css_loader_dist_runtime_api_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(645);
/* harmony import */ var _node_modules_css_loader_dist_runtime_api_js__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(_node_modules_css_loader_dist_runtime_api_js__WEBPACK_IMPORTED_MODULE_0__);
// Imports

var ___CSS_LOADER_EXPORT___ = _node_modules_css_loader_dist_runtime_api_js__WEBPACK_IMPORTED_MODULE_0___default()(function(i){return i[1]});
// Module
___CSS_LOADER_EXPORT___.push([module.id, "@media screen and (max-width: 900px){.searchBox{width:50%}}@media screen and (max-width: 600px){:root{--br: 26px}.headerUp{height:50px}.headerUp .logo{font-size:40px}.headerUp .nameApp{display:none}.btnBar{width:50px;height:50px;font-size:30px}#gps{right:10px}#search{right:70px}.searchBox{width:100%;padding:0 70px 0 60px}.barStyle{height:50px}.resultBox{left:60px;width:calc(100% - 130px)}.resultBox .closeBtn{width:50px;height:50px;font-size:30px}.cardBox{--fAqi: 46px;--fBig: 22px;--fMid: 16px;width:96%}}\n", ""]);
// Exports
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (___CSS_LOADER_EXPORT___);


/***/ }),

/***/ 192:
/***/ ((module, __webpack_exports__, __webpack_require__) => {

/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "Z": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _node_modules_css_loader_dist_runtime_api_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(645);
/* harmony import */ var _node_modules_css_loader_dist_runtime_api_js__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(_node_modules_css_loader_dist_runtime_api_js__WEBPACK_IMPORTED_MODULE_0__);
// Imports

var ___CSS_LOADER_EXPORT___ = _node_modules_css_loader_dist_runtime_api_js__WEBPACK_IMPORTED_MODULE_0___default()(function(i){return i[1]});
// Module
___CSS_LOADER_EXPORT___.push([module.id, "*{box-sizing:border-box}input{outline-style:none}html,body{margin:0;padding:0}:root{--br: 16px;--font: 16px;--principalColor: rgb(0, 132, 255)}.screen{position:fixed;display:flex;flex-direction:column;justify-content:center;align-items:center;overflow:hidden;width:100%;min-height:100%;height:100%}.header{--flogo: 60px;--fname: 40px;position:fixed;display:flex;align-items:center;justify-content:center;top:calc(50% - 70px);width:100%;height:36px}.header .logo{font-size:var(--flogo);color:var(--principalColor)}.header .nameApp{font-family:'Roboto';font-size:var(--fname);font-weight:400;margin:0;padding:0;padding-left:4px}.headerUp{--flogo: 30px;--fname: 22px;position:fixed;display:flex;align-items:center;justify-content:flex-start;top:10px;left:10px;width:100%;height:36px}.btnBar{display:flex;justify-content:center;align-items:center;width:36px;height:36px;font-size:22px;transition:0.2s;z-index:200;cursor:pointer}#gps{position:absolute;border:1px solid rgba(0,0,0,0.2);border-radius:50%;right:-46px}#search{position:absolute;right:0;color:rgba(0,0,0,0.4)}.pending{color:#ffa51d}.success{color:var(--principalColor)}.err{background:#da2323;color:white}.searchBox{position:relative;display:flex;justify-content:center;align-items:center;width:500px}.searchBox form{display:flex;width:100%;justify-content:center}.barStyle{width:100%;height:36px;padding:6px 20px 6px 20px;border:1px solid rgba(0,0,0,0.2);border-radius:var(--br);font-family:'Roboto';font-size:var(--font)}.resultBox{position:absolute;display:flex;flex-direction:column;align-items:center;overflow:hidden;width:100%;border-radius:var(--br);z-index:500}.resultBox .closeBtn{position:absolute;display:flex;justify-content:center;align-items:center;right:0;width:36px;height:36px;font-size:22px;color:rgba(0,0,0,0.3);cursor:pointer}.resultBox .closeBtn:hover{color:#af3333}.resultBox .datalist{display:flex;flex-direction:column;overflow:hidden;width:100%;border-radius:0 0 var(--br) var(--br);background:white}.resultBox .datalist .option{padding:6px 10px 6px 20px;font-size:var(--font)}.resultBox .datalist .option:hover{background:#ccc}.open{border-radius:var(--br) var(--br) 0 0;border:none;overflow:clip}.close{display:none !important}.shadow{box-shadow:0 0px 2px rgba(0,0,0,0.3),0 8px 10px rgba(0,0,0,0.2) !important}.hidden{display:none}.fix{position:relative}.upper{justify-content:flex-start;row-gap:10px;padding-top:10px}.cardBox{--fAqi: 60px;--fBig: 36px;--fMid: 18px;--fSml: 16px;--fAle: 22px;display:grid;grid-template-columns:30% 70%;grid-template-rows:auto;grid-template-areas:\"aqi city\"\r \"aqi station\"\r \"alert alert\"\r \"tips tips\"\r \"gtitle gtitle\"\r \"graph graph\";overflow:hidden;border-radius:var(--br);width:600px;font-family:'Roboto';box-shadow:0 4px 10px rgba(0,0,0,0.2);transition:0.2s}.cardBox .city{grid-area:city;font-size:var(--fBig);text-align:end;padding:10px 20px 0 20px;color:white;text-shadow:0 0 4px rgba(0,0,0,0.3)}.cardBox .station{grid-area:station;font-size:var(--fMid);padding:10px 20px 0 20px;text-align:end;color:white;text-shadow:0 0 4px rgba(0,0,0,0.3)}.cardBox .aqi{grid-area:aqi;display:flex;align-items:baseline;text-align:start;padding:10px 20px 0 20px;color:white;text-shadow:0 0 4px rgba(0,0,0,0.3)}.cardBox .aqi .aqiNum{font-size:var(--fAqi)}.cardBox .aqi .aqiNam{font-size:var(--fBig)}.cardBox .alert{grid-area:alert;padding:0 0 10px 20px;text-align:start;text-transform:uppercase;font-size:var(--fMid);font-weight:600;letter-spacing:4px;color:white;text-shadow:0 0 4px rgba(0,0,0,0.3)}.cardBox .tips{padding:20px;grid-area:tips;font-size:var(--fMid);font-weight:300}.cardBox .gtitle{grid-area:gtitle;text-align:center;font-size:var(--fSml);font-weight:800;letter-spacing:5px;color:rgba(0,0,0,0.4)}.cardBox .graph{position:relative;grid-area:graph;width:100%;height:150px;display:grid;grid-template-columns:25% 25% 25% 25%;grid-template-rows:auto 20%;grid-template-areas:\"pm25g pm10g no2g o3g\"\r \"pm25 pm10 no2 o3\";justify-items:center;align-items:flex-end}.cardBox .graph .grid{grid-area:1 / 1 / span 1 / span 4;grid-template-columns:auto;grid-template-rows:auto auto auto auto auto auto;grid-template-areas:\"bar5\"\r \"bar4\"\r \"bar3\"\r \"bar2\"\r \"bar1\"\r \"bar0\";width:100%;height:100%;display:grid}.cardBox .graph .grid .bar{width:100%;height:1px;background:rgba(0,0,0,0.1)}.cardBox .graph .grid .bar0{grid-area:bar0}.cardBox .graph .grid .bar1{grid-area:bar1}.cardBox .graph .grid .bar2{grid-area:bar2}.cardBox .graph .grid .bar3{grid-area:bar3}.cardBox .graph .grid .bar4{grid-area:bar4}.cardBox .graph .ps{padding:5px;height:100%;width:100%;border-top:1px solid rgba(0,0,0,0.2);text-align:center;font-size:var(--fSml);font-weight:800;color:rgba(0,0,0,0.5)}.cardBox .graph .pm25{grid-area:pm25}.cardBox .graph .pm10{grid-area:pm10}.cardBox .graph .no2{grid-area:no2}.cardBox .graph .o3{grid-area:o3}.cardBox .graph .gbox{width:30px}.cardBox .graph .pm25g{--h: 0%;grid-area:pm25g;height:var(--h);background:var(--color)}.cardBox .graph .pm10g{--h: 0%;grid-area:pm10g;height:var(--h);background:var(--color)}.cardBox .graph .no2g{--h: 0%;grid-area:no2g;height:var(--h);background:var(--color)}.cardBox .graph .o3g{--h: 0%;grid-area:o3g;height:var(--h);background:var(--color)}.cardBox:hover{box-shadow:0 10px 10px rgba(0,0,0,0.4)}.good{background:#6c9918}.moderate{background:#228cac}.bitUnhealthy{background:#eb9d0c}.unhealthy{background:#dd0a0a}.veryUnhealthy{background:#991919}.hazard{background:#8c00ff}.statusBar{position:fixed;display:flex;justify-content:center;font-family:'Roboto';width:100%;bottom:0;transition:0.2s}.err{background:red}.collapse{bottom:-20px}.noResult{display:flex;justify-content:center;top:0;box-shadow:none;text-align:center;width:100%}.noResult:hover{box-shadow:none}\n", ""]);
// Exports
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (___CSS_LOADER_EXPORT___);


/***/ }),

/***/ 645:
/***/ ((module) => {



/*
  MIT License http://www.opensource.org/licenses/mit-license.php
  Author Tobias Koppers @sokra
*/
// css base code, injected by the css-loader
// eslint-disable-next-line func-names
module.exports = function (cssWithMappingToString) {
  var list = []; // return the list of modules as css string

  list.toString = function toString() {
    return this.map(function (item) {
      var content = cssWithMappingToString(item);

      if (item[2]) {
        return "@media ".concat(item[2], " {").concat(content, "}");
      }

      return content;
    }).join("");
  }; // import a list of modules into the list
  // eslint-disable-next-line func-names


  list.i = function (modules, mediaQuery, dedupe) {
    if (typeof modules === "string") {
      // eslint-disable-next-line no-param-reassign
      modules = [[null, modules, ""]];
    }

    var alreadyImportedModules = {};

    if (dedupe) {
      for (var i = 0; i < this.length; i++) {
        // eslint-disable-next-line prefer-destructuring
        var id = this[i][0];

        if (id != null) {
          alreadyImportedModules[id] = true;
        }
      }
    }

    for (var _i = 0; _i < modules.length; _i++) {
      var item = [].concat(modules[_i]);

      if (dedupe && alreadyImportedModules[item[0]]) {
        // eslint-disable-next-line no-continue
        continue;
      }

      if (mediaQuery) {
        if (!item[2]) {
          item[2] = mediaQuery;
        } else {
          item[2] = "".concat(mediaQuery, " and ").concat(item[2]);
        }
      }

      list.push(item);
    }
  };

  return list;
};

/***/ }),

/***/ 379:
/***/ ((module, __unused_webpack_exports, __webpack_require__) => {



var isOldIE = function isOldIE() {
  var memo;
  return function memorize() {
    if (typeof memo === 'undefined') {
      // Test for IE <= 9 as proposed by Browserhacks
      // @see http://browserhacks.com/#hack-e71d8692f65334173fee715c222cb805
      // Tests for existence of standard globals is to allow style-loader
      // to operate correctly into non-standard environments
      // @see https://github.com/webpack-contrib/style-loader/issues/177
      memo = Boolean(window && document && document.all && !window.atob);
    }

    return memo;
  };
}();

var getTarget = function getTarget() {
  var memo = {};
  return function memorize(target) {
    if (typeof memo[target] === 'undefined') {
      var styleTarget = document.querySelector(target); // Special case to return head of iframe instead of iframe itself

      if (window.HTMLIFrameElement && styleTarget instanceof window.HTMLIFrameElement) {
        try {
          // This will throw an exception if access to iframe is blocked
          // due to cross-origin restrictions
          styleTarget = styleTarget.contentDocument.head;
        } catch (e) {
          // istanbul ignore next
          styleTarget = null;
        }
      }

      memo[target] = styleTarget;
    }

    return memo[target];
  };
}();

var stylesInDom = [];

function getIndexByIdentifier(identifier) {
  var result = -1;

  for (var i = 0; i < stylesInDom.length; i++) {
    if (stylesInDom[i].identifier === identifier) {
      result = i;
      break;
    }
  }

  return result;
}

function modulesToDom(list, options) {
  var idCountMap = {};
  var identifiers = [];

  for (var i = 0; i < list.length; i++) {
    var item = list[i];
    var id = options.base ? item[0] + options.base : item[0];
    var count = idCountMap[id] || 0;
    var identifier = "".concat(id, " ").concat(count);
    idCountMap[id] = count + 1;
    var index = getIndexByIdentifier(identifier);
    var obj = {
      css: item[1],
      media: item[2],
      sourceMap: item[3]
    };

    if (index !== -1) {
      stylesInDom[index].references++;
      stylesInDom[index].updater(obj);
    } else {
      stylesInDom.push({
        identifier: identifier,
        updater: addStyle(obj, options),
        references: 1
      });
    }

    identifiers.push(identifier);
  }

  return identifiers;
}

function insertStyleElement(options) {
  var style = document.createElement('style');
  var attributes = options.attributes || {};

  if (typeof attributes.nonce === 'undefined') {
    var nonce =  true ? __webpack_require__.nc : 0;

    if (nonce) {
      attributes.nonce = nonce;
    }
  }

  Object.keys(attributes).forEach(function (key) {
    style.setAttribute(key, attributes[key]);
  });

  if (typeof options.insert === 'function') {
    options.insert(style);
  } else {
    var target = getTarget(options.insert || 'head');

    if (!target) {
      throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");
    }

    target.appendChild(style);
  }

  return style;
}

function removeStyleElement(style) {
  // istanbul ignore if
  if (style.parentNode === null) {
    return false;
  }

  style.parentNode.removeChild(style);
}
/* istanbul ignore next  */


var replaceText = function replaceText() {
  var textStore = [];
  return function replace(index, replacement) {
    textStore[index] = replacement;
    return textStore.filter(Boolean).join('\n');
  };
}();

function applyToSingletonTag(style, index, remove, obj) {
  var css = remove ? '' : obj.media ? "@media ".concat(obj.media, " {").concat(obj.css, "}") : obj.css; // For old IE

  /* istanbul ignore if  */

  if (style.styleSheet) {
    style.styleSheet.cssText = replaceText(index, css);
  } else {
    var cssNode = document.createTextNode(css);
    var childNodes = style.childNodes;

    if (childNodes[index]) {
      style.removeChild(childNodes[index]);
    }

    if (childNodes.length) {
      style.insertBefore(cssNode, childNodes[index]);
    } else {
      style.appendChild(cssNode);
    }
  }
}

function applyToTag(style, options, obj) {
  var css = obj.css;
  var media = obj.media;
  var sourceMap = obj.sourceMap;

  if (media) {
    style.setAttribute('media', media);
  } else {
    style.removeAttribute('media');
  }

  if (sourceMap && typeof btoa !== 'undefined') {
    css += "\n/*# sourceMappingURL=data:application/json;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(sourceMap)))), " */");
  } // For old IE

  /* istanbul ignore if  */


  if (style.styleSheet) {
    style.styleSheet.cssText = css;
  } else {
    while (style.firstChild) {
      style.removeChild(style.firstChild);
    }

    style.appendChild(document.createTextNode(css));
  }
}

var singleton = null;
var singletonCounter = 0;

function addStyle(obj, options) {
  var style;
  var update;
  var remove;

  if (options.singleton) {
    var styleIndex = singletonCounter++;
    style = singleton || (singleton = insertStyleElement(options));
    update = applyToSingletonTag.bind(null, style, styleIndex, false);
    remove = applyToSingletonTag.bind(null, style, styleIndex, true);
  } else {
    style = insertStyleElement(options);
    update = applyToTag.bind(null, style, options);

    remove = function remove() {
      removeStyleElement(style);
    };
  }

  update(obj);
  return function updateStyle(newObj) {
    if (newObj) {
      if (newObj.css === obj.css && newObj.media === obj.media && newObj.sourceMap === obj.sourceMap) {
        return;
      }

      update(obj = newObj);
    } else {
      remove();
    }
  };
}

module.exports = function (list, options) {
  options = options || {}; // Force single-tag solution on IE6-9, which has a hard limit on the # of <style>
  // tags it will allow on a page

  if (!options.singleton && typeof options.singleton !== 'boolean') {
    options.singleton = isOldIE();
  }

  list = list || [];
  var lastIdentifiers = modulesToDom(list, options);
  return function update(newList) {
    newList = newList || [];

    if (Object.prototype.toString.call(newList) !== '[object Array]') {
      return;
    }

    for (var i = 0; i < lastIdentifiers.length; i++) {
      var identifier = lastIdentifiers[i];
      var index = getIndexByIdentifier(identifier);
      stylesInDom[index].references--;
    }

    var newLastIdentifiers = modulesToDom(newList, options);

    for (var _i = 0; _i < lastIdentifiers.length; _i++) {
      var _identifier = lastIdentifiers[_i];

      var _index = getIndexByIdentifier(_identifier);

      if (stylesInDom[_index].references === 0) {
        stylesInDom[_index].updater();

        stylesInDom.splice(_index, 1);
      }
    }

    lastIdentifiers = newLastIdentifiers;
  };
};

/***/ })

/******/ 	});
/************************************************************************/
/******/ 	// The module cache
/******/ 	var __webpack_module_cache__ = {};
/******/ 	
/******/ 	// The require function
/******/ 	function __webpack_require__(moduleId) {
/******/ 		// Check if module is in cache
/******/ 		var cachedModule = __webpack_module_cache__[moduleId];
/******/ 		if (cachedModule !== undefined) {
/******/ 			return cachedModule.exports;
/******/ 		}
/******/ 		// Create a new module (and put it into the cache)
/******/ 		var module = __webpack_module_cache__[moduleId] = {
/******/ 			id: moduleId,
/******/ 			// no module.loaded needed
/******/ 			exports: {}
/******/ 		};
/******/ 	
/******/ 		// Execute the module function
/******/ 		__webpack_modules__[moduleId](module, module.exports, __webpack_require__);
/******/ 	
/******/ 		// Return the exports of the module
/******/ 		return module.exports;
/******/ 	}
/******/ 	
/************************************************************************/
/******/ 	/* webpack/runtime/compat get default export */
/******/ 	(() => {
/******/ 		// getDefaultExport function for compatibility with non-harmony modules
/******/ 		__webpack_require__.n = (module) => {
/******/ 			var getter = module && module.__esModule ?
/******/ 				() => (module['default']) :
/******/ 				() => (module);
/******/ 			__webpack_require__.d(getter, { a: getter });
/******/ 			return getter;
/******/ 		};
/******/ 	})();
/******/ 	
/******/ 	/* webpack/runtime/define property getters */
/******/ 	(() => {
/******/ 		// define getter functions for harmony exports
/******/ 		__webpack_require__.d = (exports, definition) => {
/******/ 			for(var key in definition) {
/******/ 				if(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {
/******/ 					Object.defineProperty(exports, key, { enumerable: true, get: definition[key] });
/******/ 				}
/******/ 			}
/******/ 		};
/******/ 	})();
/******/ 	
/******/ 	/* webpack/runtime/hasOwnProperty shorthand */
/******/ 	(() => {
/******/ 		__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))
/******/ 	})();
/******/ 	
/************************************************************************/
var __webpack_exports__ = {};
// This entry need to be wrapped in an IIFE because it need to be isolated against other modules in the chunk.
(() => {

// EXTERNAL MODULE: ./node_modules/style-loader/dist/runtime/injectStylesIntoStyleTag.js
var injectStylesIntoStyleTag = __webpack_require__(379);
var injectStylesIntoStyleTag_default = /*#__PURE__*/__webpack_require__.n(injectStylesIntoStyleTag);
// EXTERNAL MODULE: ./node_modules/css-loader/dist/cjs.js!./node_modules/sass-loader/dist/cjs.js!./src/style.scss
var style = __webpack_require__(192);
;// CONCATENATED MODULE: ./src/style.scss

            

var options = {};

options.insert = "head";
options.singleton = false;

var update = injectStylesIntoStyleTag_default()(style/* default */.Z, options);



/* harmony default export */ const src_style = (style/* default.locals */.Z.locals || {});
// EXTERNAL MODULE: ./node_modules/css-loader/dist/cjs.js!./node_modules/sass-loader/dist/cjs.js!./src/mediaQ.scss
var mediaQ = __webpack_require__(818);
;// CONCATENATED MODULE: ./src/mediaQ.scss

            

var mediaQ_options = {};

mediaQ_options.insert = "head";
mediaQ_options.singleton = false;

var mediaQ_update = injectStylesIntoStyleTag_default()(mediaQ/* default */.Z, mediaQ_options);



/* harmony default export */ const src_mediaQ = (mediaQ/* default.locals */.Z.locals || {});
;// CONCATENATED MODULE: ./src/index.js
//AIR POLLUTION APP
//RENATO SALZANO
//STAR2IMPACT PROJECT



;


//VAR
const search = document.querySelector('#search');
const gps = document.querySelector('#gps');
const token = ("5bd17011f5161ab53342dd6fd5c2dcc3aafb3be0");

let statusBar = document.querySelector('.statusBar');
let screen = document.querySelector('.screen');
let header = document.querySelector('.header')
let searchBar = document.querySelector('.searchBar');
let cardBox = document.querySelector('.cardBox');
let resultBox;
let inputList;
let datalist;
let inputValue;

//GET REQUEST TO ALLOW POSITION
window.addEventListener('load', () => {
  const status = document.querySelector('#status');

  if(!navigator.geolocation) {
    gps.style.color = 'gray'
  } else {
    gps.classList.add('pending')
    navigator.geolocation.getCurrentPosition(success,error);
  }

  function success() {
    gps.classList.add('success')
    status.textContent = '';

  }

  function error() {
    gps.classList.add('err')
    status.textContent = 'Geolocation is not supported by your browser';
    statusBar.classList.add('err');
    statusBar.classList.add('collapse');
  }
});

gps.addEventListener('click', () => {

  const status = document.querySelector('#status');

  if(!navigator.geolocation) {
    status.textContent = 'Geolocation is not supported by your browser';
    statusBar.classList.add('err');
    statusBar.classList.add('collapse');
  } else {
    navigator.geolocation.getCurrentPosition(success, error);
  }

  //IF USER ALLOW POSITION
  function success(position) {
    status.textContent = '';
    if(gps.classList.contains('err')) {
      gps.classList.remove('err');
    }
    gps.classList.add('success')

    const lat  = position.coords.latitude;
    const long = position.coords.longitude;
    
    getData(lat, long);
  }

  function error() {
    status.textContent = 'Unable to retrieve your location';
    gps.classList.add('err')
    statusBar.classList.add('err');
  }
});

let input = document.input.city

search.addEventListener('click', () => {

  const api = `https://api.waqi.info/search/?token=${token}&keyword=${input.value}`

  if(input.value == '') {
    input.placeholder = 'Please, type something'
  }else{

  fetch(api)
    .then(response => {
      return response.json();
    })
    .then(data => {
      const _data = data.data;
      console.log(_data)

      //fix
      let patt = new RegExp(/[,|;| |-]/gi)
      inputValue = input.value.replace(patt, '').toLowerCase();
      console.log(inputValue)
          
      //for(let i = 0; i < _data.length; i++) { console.log(_data[i].station.name.replace(patt, ' ').toLowerCase()) }
          
      let testing = "\\b" +inputValue+ "\\b";
         
      let regValue = new RegExp(inputValue)
      let regValueFix = new RegExp(testing, 'gi')

      //Frist filter
      let result = _data.filter(_data => 
      regValue.test(_data.station.name.replace(patt, '').toLowerCase()));

      //Sec filter input word by word
      let resultFix = result.filter(result => 
      regValueFix.test(result.station.name.replace(patt, ' ').toLowerCase()));

      if(resultFix.length == 0) {
        //if array is empty restore frist result
        resultFix = result;
      }
      processResult(resultFix);
          
    });
  };
});

function processResult(result) {

  if(result.length > 1) {
    //console.log('array')
    console.log(result)
    createList(inputValue);
    datalist = document.querySelector('.datalist')

    for(let i = 0; i < result.length; i++) {
      
      let option = document.createElement('span')
      option.classList.add('option')
              
      option.innerHTML = result[i].station.name;
      datalist.appendChild(option);

      option.onclick = () => {
      //console.log(result[i].station.geo[0], result[i].station.geo[1])

      getData(result[i].station.geo[0], result[i].station.geo[1]);
      resultBox.remove();
      search.classList.remove('hidden');
      searchBar.value = result[i].station.name.split(', ')[0];
                  
      }
    }

  }else if(result.length == 1){
    //console.log('one result')
    getData(result[0].station.geo[0], result[0].station.geo[1]);
  }else{
    //console.log('no results')
    screen.classList.add('upper');
    header.classList.add('headerUp');
    cardBox.innerHTML = `Sorry, it seems there are no results for "${input.value}" `;
    cardBox.classList.add('noResult');
  }

}



function createList(result) {
  
  resultBox = document.createElement('div');
  inputList = document.createElement('input');
  datalist = document.createElement('div');
  let closeBtn = document.createElement('div');

  inputList.value = result
  inputList.classList.add('barStyle');
  inputList.classList.add('open');
  datalist.classList.add('datalist');
  resultBox.classList.add('resultBox')
  resultBox.classList.add('shadow');
  search.classList.add('hidden');
  closeBtn.classList.add('closeBtn');
  closeBtn.innerHTML = '<span class="iconify" data-icon="mdi:close" data-inline="false"></span>'
  
  inputList.setAttribute('type', 'text');
  searchBar.insertAdjacentElement('afterend',resultBox);
  resultBox.appendChild(inputList);
  resultBox.appendChild(closeBtn);
  inputList.insertAdjacentElement('afterend',datalist);

  inputList.onclick = () => {
    inputList.classList.toggle('open');
    resultBox.classList.toggle('shadow');
    datalist.classList.toggle('close');
  }
  inputList.oninput = () => {
    if(inputList.value == '') {
      if(search.classList.contains('hidden')) {
        search.classList.remove('hidden');
      }
      resultBox.remove();
      searchBar.value = '';
    }
  }
  window.addEventListener('click', function(e){   
    if (!resultBox.contains(e.target)){
      if(inputList.classList.contains('open')){
        //close list
        inputList.click();
      }
    }
  });
  closeBtn.onclick = () => {
    //remove result
    search.classList.remove('hidden')
    resultBox.remove();
  };

}
function getData(lat, long) {
  const api = `https://api.waqi.info/feed/geo:${lat};${long}/?token=${token}`;

  fetch(api)
        .then(response => {
          return response.json();
      })
        .then(data => {
        console.log(data.data)
        const _data = data.data;
        let city = _data.city.name.split(', ')[0];
        let station = _data.city.name.split(', ')[1];
        let aqiNum = _data.aqi;
        //pollution var
        let pm25;
        let pm10;
        let no2;
        let o3;
        
        try {
          pm25 = _data.iaqi.pm25.v;
        }catch (err) {
          pm25 = 0;
        }
        try {
          pm10 = _data.iaqi.pm10.v;
        }catch (err) {
          pm10 = 0;
        }
        try {
          no2 = _data.iaqi.no2.v;
        }catch (err) {
          no2 = 0;
        }
        try {
          o3 = _data.iaqi.o3.v;
        }catch (err) {
          o3 = 0;
        }
        
        if(city == undefined) {city = station};
        if(station == undefined) {station = ''};
        //console.log(city, station, aqiNum, pm25, pm10, no2, o3);
        showResult(city, station, aqiNum, pm25, pm10, no2, o3)
      });
}
function showResult(city, station, aqiNum, pm25, pm10, no2, o3) {
  if(cardBox.classList.contains('noResult')) {
    cardBox.classList.remove('noResult');
  }
  screen.classList.add('upper');
  header.classList.add('headerUp');
  //create card
  cardBox.innerHTML = `<span class='city alertBG'>${city}</span>
  <span class='station alertBG'>${station}</span>
  <div class="aqi alertBG">
  <span class='aqiNum'>${aqiNum}</span><span class='aqiNam'>AQI</span>
  </div>
  <span class="alert alertBG"></span>
  <div class="tips"></div>
  <span class="gtitle">MAIN POLLUTANTS</span>
  <div class="graph">
  <div class="grid">
  <div class="bar4 bar"></div>
  <div class="bar3 bar"></div>
  <div class="bar2 bar"></div>
  <div class="bar1 bar"></div>
  <div class="bar0 bar"></div>
  </div>
  
  <span class="pm25 ps">PM2.5</span>
  <span class="pm25g gbox"></span>
  <span class="pm10 ps">PM10</span>
  <span class="pm10g gbox"></span>
  <span class="no2 ps">NO<sub>2</sub></span>
  <span class="no2g gbox"></span>
  <span class="o3 ps">O<sub>3</sub></span>
  <span class="o3g gbox"></span>
  </div>`;

  //ALERT BG COLOR
  let alertBg = document.querySelectorAll('.alertBG');
  let alert = document.querySelector('.alert');
  let aqiNumber = aqiNum;
  let tips = document.querySelector('.tips');
  for(let i = 0; i < alertBg.length; i++) {
  switch(true) {
    case aqiNumber <= 50:
      alertBg[i].classList.add('good');
      alert.innerHTML = 'Good';
      tips.innerHTML = 'Air quality is considered satisfactory, and air pollution poses little or no risk.'
    break;
    case aqiNumber > 50 && aqiNumber < 100:
      alertBg[i].classList.add('moderate');
      alert.innerHTML = 'Moderate'
      tips.innerHTML = 'Air quality is acceptable.<br> However, for some pollutants there may be a moderate health concern for a very small number of people who are unusually sensitive to air pollution.'
    break;
    case aqiNumber > 100 && aqiNumber < 150:
      alertBg[i].classList.add('bitUnhealthy');
      alert.innerHTML = 'Unhealthy for Sensitive Groups'
      tips.innerHTML = 'Members of sensitive groups may experience health effects.<br> The general public is not likely to be affected.'
    break;
    case aqiNumber > 150 && aqiNumber < 200:
      alertBg[i].classList.add('unhealthy');
      alert.innerHTML = 'Unhealthy'
      tips.innerHTML = 'Everyone may begin to experience health effects.<br>Members of sensitive groups may experience more serious health effects'
    break;
    case aqiNumber > 200 && aqiNumber < 300:
      alertBg[i].classList.add('veryUnhealthy');
      alert.innerHTML = 'Very Unhealthy'
      tips.innerHTML = 'Health warnings of emergency conditions.<br>The entire population is more likely to be affected.'
    break;
    case aqiNumber >= 300:
      alertBg[i].classList.add('hazard');
      alert.innerHTML = 'Hazardous'
      tips.innerHTML = 'Health alert: everyone may experience more serious health effects'
    break;
  }
  }
  //GRAPH--------------------------------------
  

  let pm10g = document.querySelector('.pm10g');
  let pm25g = document.querySelector('.pm25g');
  let no2g = document.querySelector('.no2g');
  let o3g = document.querySelector('.o3g');

  //pm10
  switch(true) {
    //good
    case pm10 == 0:
      pm10g.style.setProperty('--h', '0%')
    break;
    case pm10 > 0 && pm10 <= 50:
      pm10g.style.setProperty('--h', '16%')
      pm10g.style.setProperty('--color', 'rgb(108, 153, 24)')
    break;
    //moderate
    case pm10 > 50 && pm10 <= 100:
      pm10g.style.setProperty('--h', '32%')
      pm10g.style.setProperty('--color', 'rgb(25, 174, 219)')
    break;
    //bit unh
    case pm10 > 100 && pm10 <= 250:
      pm10g.style.setProperty('--h', '48%')
      pm10g.style.setProperty('--color', 'rgb(235, 157, 12)')
    break;
    //unh
    case pm10 > 250 && pm10 <= 350:
      pm10g.style.setProperty('--h', '65%')
      pm10g.style.setProperty('--color', 'rgb(221, 10, 10)')
    break;
    //very unh
    case pm10 > 350 && pm10 <= 430:
      pm10g.style.setProperty('--h', '75%')
      pm10g.style.setProperty('--color', 'rgb(153, 25, 25)')
    break;
    //hazard
    case pm10 >= 430:
      pm10g.style.setProperty('--h', '100%')
      pm10g.style.setProperty('--color', 'rgb(153, 25, 25)')
    break;
  }
  //pm25
  switch(true) {
    case pm25 == 0:
      pm25g.style.setProperty('--h', '0%')
    break;
    //good
    case pm25 > 0 && pm25 <= 30:
      pm25g.style.setProperty('--h', '16%')
      pm25g.style.setProperty('--color', 'rgb(108, 153, 24)')
    break;
    //moderate
    case pm25 > 30 && pm25 <= 60:
      pm25g.style.setProperty('--h', '32%')
      pm25g.style.setProperty('--color', 'rgb(25, 174, 219)')
    break;
    //bit unh
    case pm25 > 60 && pm25 <= 90:
      pm25g.style.setProperty('--h', '48%')
      pm25g.style.setProperty('--color', 'rgb(235, 157, 12)')
    break;
    //unh
    case pm25 > 90 && pm25 <= 120:
      pm25g.style.setProperty('--h', '65%')
      pm25g.style.setProperty('--color', 'rgb(221, 10, 10)')
    break;
    //very unh
    case pm25 > 120 && pm25 <= 250:
      pm25g.style.setProperty('--h', '75%')
      pm25g.style.setProperty('--color', 'rgb(153, 25, 25)')
    break;
    //hazard
    case pm25 >= 250:
      pm25g.style.setProperty('--h', '100%')
      pm25g.style.setProperty('--color', 'rgb(153, 25, 25)')
    break;
  }
  //no2
  switch(true) {
    case no2 == 0:
      no2g.style.setProperty('--h', '0%')
    break;
    //good
    case no2 > 0 && no2 <= 40:
      no2g.style.setProperty('--h', '16%')
      no2g.style.setProperty('--color', 'rgb(108, 153, 24)')
    break;
    //moderate
    case no2 > 40 && no2 <= 80:
      no2g.style.setProperty('--h', '32%')
      no2g.style.setProperty('--color', 'rgb(25, 174, 219)')
    break;
    //bit unh
    case no2 > 80 && no2 <= 180:
      no2g.style.setProperty('--h', '48%')
      no2g.style.setProperty('--color', 'rgb(235, 157, 12)')
    break;
    //unh
    case no2 > 180 && no2 <= 280:
      no2g.style.setProperty('--h', '65%')
      no2g.style.setProperty('--color', 'rgb(221, 10, 10)')
    break;
    //very unh
    case no2 > 280 && no2 <= 400:
      no2g.style.setProperty('--h', '75%')
      no2g.style.setProperty('--color', 'rgb(153, 25, 25)')
    break;
    //hazard
    case no2 >= 400:
      no2g.style.setProperty('--h', '100%')
      no2g.style.setProperty('--color', 'rgb(153, 25, 25)')
    break;
  }
  //o3
  switch(true) {
    case o3 == 0:
      o3g.style.setProperty('--h', '0%')
    break;
    //good
    case o3 > 0 && o3 <= 50:
      o3g.style.setProperty('--h', '16%')
      o3g.style.setProperty('--color', 'rgb(108, 153, 24)')
    break;
    //moderate
    case o3 > 50 && o3 <= 100:
      o3g.style.setProperty('--h', '32%')
      o3g.style.setProperty('--color', 'rgb(25, 174, 219)')
    break;
    //bit unh
    case o3 > 100 && o3 <= 170:
      o3g.style.setProperty('--h', '48%')
      o3g.style.setProperty('--color', 'rgb(235, 157, 12)')
    break;
    //unh
    case o3 > 170 && o3 <= 210:
      o3g.style.setProperty('--h', '65%')
      o3g.style.setProperty('--color', 'rgb(221, 10, 10)')
    break;
    //very unh
    case o3 > 210 && o3 <= 750:
      o3g.style.setProperty('--h', '75%')
      o3g.style.setProperty('--color', 'rgb(153, 25, 25)')
    break;
    //hazard
    case o3 >= 750:
      o3g.style.setProperty('--h', '100%')
      o3g.style.setProperty('--color', 'rgb(153, 25, 25)')
    break;
  }
  


}

searchBar.addEventListener("keydown", function (evt) {
  if (evt.defaultPrevented) {
    return;
  }

  switch (evt.key) {
    
    case "Enter":
      search.click();
      break;

    default:
      return;
  }
  evt.preventDefault();
}, true);


})();

/******/ })()
;