(()=>{"use strict";const e=document.querySelector("#search"),t=document.querySelector("#gps"),s="5bd17011f5161ab53342dd6fd5c2dcc3aafb3be0";let r,a,o,n,l=document.querySelector(".statusBar"),c=document.querySelector(".screen"),i=document.querySelector(".header"),d=document.querySelector(".searchBar"),y=document.querySelector(".cardBox");window.addEventListener("load",(()=>{const e=document.querySelector("#status");navigator.geolocation?(t.classList.add("pending"),navigator.geolocation.getCurrentPosition((function(){t.classList.add("success"),e.textContent=""}),(function(){t.classList.add("err"),e.textContent="Geolocation is not supported by your browser",l.classList.add("err"),l.classList.add("collapse")}))):t.style.color="gray"})),t.addEventListener("click",(()=>{const e=document.querySelector("#status");navigator.geolocation?navigator.geolocation.getCurrentPosition((function(s){e.textContent="",t.classList.contains("err")&&t.classList.remove("err"),t.classList.add("success");u(s.coords.latitude,s.coords.longitude)}),(function(){e.textContent="Unable to retrieve your location",t.classList.add("err"),l.classList.add("err")})):(e.textContent="Geolocation is not supported by your browser",l.classList.add("err"),l.classList.add("collapse"))}));let p=document.input.city;function u(e,t){fetch(`https://api.waqi.info/feed/geo:${e};${t}/?token=${s}`).then((e=>e.json())).then((e=>{console.log(e.data);const t=e.data;let s,r,a,o,n=t.city.name.split(", ")[0],l=t.city.name.split(", ")[1],d=t.aqi;try{s=t.iaqi.pm25.v}catch(e){s=0}try{r=t.iaqi.pm10.v}catch(e){r=0}try{a=t.iaqi.no2.v}catch(e){a=0}try{o=t.iaqi.o3.v}catch(e){o=0}null==n&&(n=l),null==l&&(l=""),function(e,t,s,r,a,o,n){y.classList.contains("noResult")&&y.classList.remove("noResult"),c.classList.add("upper"),i.classList.add("headerUp"),y.innerHTML=`<span class='city alertBG'>${e}</span>\n  <span class='station alertBG'>${t}</span>\n  <div class="aqi alertBG">\n  <span class='aqiNum'>${s}</span><span class='aqiNam'>AQI</span>\n  </div>\n  <span class="alert alertBG"></span>\n  <div class="tips"></div>\n  <span class="gtitle">MAIN POLLUTANTS</span>\n  <div class="graph">\n  <div class="grid">\n  <div class="bar4 bar"></div>\n  <div class="bar3 bar"></div>\n  <div class="bar2 bar"></div>\n  <div class="bar1 bar"></div>\n  <div class="bar0 bar"></div>\n  </div>\n  \n  <span class="pm25 ps">PM2.5</span>\n  <span class="pm25g gbox"></span>\n  <span class="pm10 ps">PM10</span>\n  <span class="pm10g gbox"></span>\n  <span class="no2 ps">NO<sub>2</sub></span>\n  <span class="no2g gbox"></span>\n  <span class="o3 ps">O<sub>3</sub></span>\n  <span class="o3g gbox"></span>\n  </div>`;let l=document.querySelectorAll(".alertBG"),d=document.querySelector(".alert"),p=s,u=document.querySelector(".tips");for(let e=0;e<l.length;e++)switch(!0){case p<=50:l[e].classList.add("good"),d.innerHTML="Good",u.innerHTML="Air quality is considered satisfactory, and air pollution poses little or no risk.";break;case p>50&&p<100:l[e].classList.add("moderate"),d.innerHTML="Moderate",u.innerHTML="Air quality is acceptable.<br> However, for some pollutants there may be a moderate health concern for a very small number of people who are unusually sensitive to air pollution.";break;case p>100&&p<150:l[e].classList.add("bitUnhealthy"),d.innerHTML="Unhealthy for Sensitive Groups",u.innerHTML="Members of sensitive groups may experience health effects.<br> The general public is not likely to be affected.";break;case p>150&&p<200:l[e].classList.add("unhealthy"),d.innerHTML="Unhealthy",u.innerHTML="Everyone may begin to experience health effects.<br>Members of sensitive groups may experience more serious health effects";break;case p>200&&p<300:l[e].classList.add("veryUnhealthy"),d.innerHTML="Very Unhealthy",u.innerHTML="Health warnings of emergency conditions.<br>The entire population is more likely to be affected.";break;case p>=300:l[e].classList.add("hazard"),d.innerHTML="Hazardous",u.innerHTML="Health alert: everyone may experience more serious health effects"}let h=document.querySelector(".pm10g"),b=document.querySelector(".pm25g"),g=document.querySelector(".no2g"),m=document.querySelector(".o3g");switch(!0){case 0==a:h.style.setProperty("--h","0%");break;case a>0&&a<=50:h.style.setProperty("--h","16%"),h.style.setProperty("--color","rgb(108, 153, 24)");break;case a>50&&a<=100:h.style.setProperty("--h","32%"),h.style.setProperty("--color","rgb(25, 174, 219)");break;case a>100&&a<=250:h.style.setProperty("--h","48%"),h.style.setProperty("--color","rgb(235, 157, 12)");break;case a>250&&a<=350:h.style.setProperty("--h","65%"),h.style.setProperty("--color","rgb(221, 10, 10)");break;case a>350&&a<=430:h.style.setProperty("--h","75%"),h.style.setProperty("--color","rgb(153, 25, 25)");break;case a>=430:h.style.setProperty("--h","100%"),h.style.setProperty("--color","rgb(153, 25, 25)")}switch(!0){case 0==r:b.style.setProperty("--h","0%");break;case r>0&&r<=30:b.style.setProperty("--h","16%"),b.style.setProperty("--color","rgb(108, 153, 24)");break;case r>30&&r<=60:b.style.setProperty("--h","32%"),b.style.setProperty("--color","rgb(25, 174, 219)");break;case r>60&&r<=90:b.style.setProperty("--h","48%"),b.style.setProperty("--color","rgb(235, 157, 12)");break;case r>90&&r<=120:b.style.setProperty("--h","65%"),b.style.setProperty("--color","rgb(221, 10, 10)");break;case r>120&&r<=250:b.style.setProperty("--h","75%"),b.style.setProperty("--color","rgb(153, 25, 25)");break;case r>=250:b.style.setProperty("--h","100%"),b.style.setProperty("--color","rgb(153, 25, 25)")}switch(!0){case 0==o:g.style.setProperty("--h","0%");break;case o>0&&o<=40:g.style.setProperty("--h","16%"),g.style.setProperty("--color","rgb(108, 153, 24)");break;case o>40&&o<=80:g.style.setProperty("--h","32%"),g.style.setProperty("--color","rgb(25, 174, 219)");break;case o>80&&o<=180:g.style.setProperty("--h","48%"),g.style.setProperty("--color","rgb(235, 157, 12)");break;case o>180&&o<=280:g.style.setProperty("--h","65%"),g.style.setProperty("--color","rgb(221, 10, 10)");break;case o>280&&o<=400:g.style.setProperty("--h","75%"),g.style.setProperty("--color","rgb(153, 25, 25)");break;case o>=400:g.style.setProperty("--h","100%"),g.style.setProperty("--color","rgb(153, 25, 25)")}switch(!0){case 0==n:m.style.setProperty("--h","0%");break;case n>0&&n<=50:m.style.setProperty("--h","16%"),m.style.setProperty("--color","rgb(108, 153, 24)");break;case n>50&&n<=100:m.style.setProperty("--h","32%"),m.style.setProperty("--color","rgb(25, 174, 219)");break;case n>100&&n<=170:m.style.setProperty("--h","48%"),m.style.setProperty("--color","rgb(235, 157, 12)");break;case n>170&&n<=210:m.style.setProperty("--h","65%"),m.style.setProperty("--color","rgb(221, 10, 10)");break;case n>210&&n<=750:m.style.setProperty("--h","75%"),m.style.setProperty("--color","rgb(153, 25, 25)");break;case n>=750:m.style.setProperty("--h","100%"),m.style.setProperty("--color","rgb(153, 25, 25)")}}(n,l,d,s,r,a,o)}))}e.addEventListener("click",(()=>{const t=`https://api.waqi.info/search/?token=${s}&keyword=${p.value}`;""==p.value?p.placeholder="Please, type something":fetch(t).then((e=>e.json())).then((t=>{const s=t.data;console.log(s);let l=new RegExp(/[,|;| |-]/gi);n=p.value.replace(l,"").toLowerCase(),console.log(n);let h="\\b"+n+"\\b",b=new RegExp(n),g=new RegExp(h,"gi"),m=s.filter((e=>b.test(e.station.name.replace(l,"").toLowerCase()))),L=m.filter((e=>g.test(e.station.name.replace(l," ").toLowerCase())));0==L.length&&(L=m),function(t){if(t.length>1){console.log(t),function(t){r=document.createElement("div"),a=document.createElement("input"),o=document.createElement("div");let s=document.createElement("div");a.value=t,a.classList.add("barStyle"),a.classList.add("open"),o.classList.add("datalist"),r.classList.add("resultBox"),r.classList.add("shadow"),e.classList.add("hidden"),s.classList.add("closeBtn"),s.innerHTML='<span class="iconify" data-icon="mdi:close" data-inline="false"></span>',a.setAttribute("type","text"),d.insertAdjacentElement("afterend",r),r.appendChild(a),r.appendChild(s),a.insertAdjacentElement("afterend",o),a.onclick=()=>{a.classList.toggle("open"),r.classList.toggle("shadow"),o.classList.toggle("close")},a.oninput=()=>{""==a.value&&(e.classList.contains("hidden")&&e.classList.remove("hidden"),r.remove(),d.value="")},window.addEventListener("click",(function(e){r.contains(e.target)||a.classList.contains("open")&&a.click()})),s.onclick=()=>{e.classList.remove("hidden"),r.remove()}}(n),o=document.querySelector(".datalist");for(let s=0;s<t.length;s++){let a=document.createElement("span");a.classList.add("option"),a.innerHTML=t[s].station.name,o.appendChild(a),a.onclick=()=>{u(t[s].station.geo[0],t[s].station.geo[1]),r.remove(),e.classList.remove("hidden"),d.value=t[s].station.name.split(", ")[0]}}}else 1==t.length?u(t[0].station.geo[0],t[0].station.geo[1]):(c.classList.add("upper"),i.classList.add("headerUp"),y.innerHTML=`Sorry, it seems there are no results for "${p.value}" `,y.classList.add("noResult"))}(L)}))})),d.addEventListener("keydown",(function(t){if(!t.defaultPrevented){switch(t.key){case"Enter":e.click();break;default:return}t.preventDefault()}}),!0)})();